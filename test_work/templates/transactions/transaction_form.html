{% extends 'base.html' %}

{% block title %}{{ title }} - Управление ДДС{% endblock %}

{% block content %}
<h1>{{ title }}</h1>

<form method="post" class="row g-3">
    {% csrf_token %}
    
    <div class="col-md-6">
        <label class="form-label">Дата</label>
        {{ form.date }}
    </div>
    
    <div class="col-md-6">
        <label class="form-label">Статус</label>
        {{ form.status }}
    </div>
    
    <div class="col-md-6">
        <label class="form-label">Тип операции</label>
        {{ form.transaction_type }}
    </div>
    
    <div class="col-md-6">
        <label class="form-label">Сумма (₽)</label>
        {{ form.amount }}
    </div>
    
    <div class="col-md-6">
        <label class="form-label">Категория</label>
        {{ form.category }}
    </div>
    
    <div class="col-md-6">
        <label class="form-label">Подкатегория</label>
        {{ form.subcategory }}
    </div>
    
    <div class="col-12">
        <label class="form-label">Комментарий</label>
        {{ form.comment }}
    </div>
    
    <div class="col-12">
        <button type="submit" class="btn btn-primary">Сохранить</button>
        <a href="{% url 'transaction_list' %}" class="btn btn-secondary">Отмена</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $("#id_transaction_type").change(function() {
        var url = "{% url 'ajax_load_categories' %}";
        var transactionTypeId = $(this).val();
        
        $.ajax({
            url: url,
            data: {
                'transaction_type': transactionTypeId
            },
            success: function(data) {
                $("#id_category").html('<option value="">---------</option>');
                $("#id_subcategory").html('<option value="">---------</option>');
                
                $.each(data, function(key, value) {
                    $("#id_category").append('<option value="' + value.id + '">' + value.name + '</option>');
                });
            }
        });
    });

    $("#id_category").change(function() {
        var url = "{% url 'ajax_load_subcategories' %}";
        var categoryId = $(this).val();
        
        $.ajax({
            url: url,
            data: {
                'category': categoryId
            },
            success: function(data) {
                $("#id_subcategory").html('<option value="">---------</option>');
                
                $.each(data, function(key, value) {
                    $("#id_subcategory").append('<option value="' + value.id + '">' + value.name + '</option>');
                });
            }
        });
    });
});
</script>
{% endblock %}
